# Copilot Instructions

This is a TypeScript utility library for generating stable, unique development ports for microfrontends based on package names.

## Best practices & Style guide

### Code Style & Formatting

- Use Biome for formatting and run `lint:fix` to autofix issues.
- Use **kebab-case** for file names.
- Use **arrow functions** for simple operations.
- Use **template literals** for string interpolation.
- Keep functions **focused and single-purpose**.
- Follow consistent **import grouping** (external, internal, relative).
- Use `async/await` and `try/catch`; avoid `.then()`/`.catch()` chaining or floating promises.

### TypeScript Best Practices

- Use the strictest TS configuration: extends `@tsconfig/node18` with strict overrides.
- All builds use Vite with dual ESM/CJS output and TypeScript declaration files.
- Use [erasable syntax only](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-8.html#the---erasablesyntaxonly-option):  
  **Do not use** enums, namespaces, module declarations, parameter properties in constructors, or `export =`/`import =` syntax.
- Use `import type` for type-only imports.
- Avoid `any`; prefer `unknown` if the type is not known.
- Use `satisfies` for better type inference.
- Use `as const` for immutable object literals.
- Prefer `??` over `||` for nullish fallback.
- Use optional chaining (`?.`) for safe access.
- Use object/array **spread**, **rest**, and **destructuring**.
- Follow the most recent [Google TypeScript Style Guide](https://google.github.io/styleguide/tsguide.html) for additional conventions.

### Documentation

- Public exports must be documented using JSDoc/TSDoc with `@example` blocks.
- Internal functions, if documented, must use the `@internal` tag.
- Document breaking changes with `@deprecated` and include a console warning. Maintain backward-compatible overloads when possible.
- Keep all documentation in sync with code changes.

### Library Design

- This is a utility library with both programmatic API and CLI interface.
- Use **named exports** only; no default exports.
- Only public API functions may be exported.
- Maintain backward compatibility for existing users.
- CLI interface should be intuitive and follow common patterns.

### Error Handling

- Define and use **custom error classes** for domain-specific errors.
- Provide clear, actionable error messages.
- **Never** expose sensitive error details to users.
- Validate inputs thoroughly and provide helpful error messages.
- Degrade gracefully when possible, maintaining core functionality.

### Testing

- Use **Vitest** with Node.js environment.
- Use BDD style with `describe` / `it`.
- Use `beforeEach` / `afterEach` for setup/teardown.
- Use `vi.fn()` and `vi.mock()` for mocks.
- Write tests for all new and modified code.
- Cover success cases, error conditions, and edge cases.
- Focus tests on **behavior**, not implementation.
- Maintain at least **80% test coverage**.
- Test both programmatic API and CLI interface.

### Build & Release

- Use Vite for building with dual ESM/CJS output.
- Generate TypeScript declaration files for both formats.
- Use Lefthook for pre-commit validation (lint, test, build, publint).
- Use publint to validate package exports and compatibility.
- Follow semantic versioning for releases.

### Commit Messages

- Use [Angular commit message style](https://github.com/angular/angular/blob/main/contributing-docs/commit-message-guidelines.md#commit-message-format).
- Types: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`, `perf`, `ci`, `build`, `revert`.

### Dependencies

- Check `package.json` for library versions. Do not upgrade or downgrade dependencies without explicit instruction.
- Keep dependencies minimal for a utility library.
- Prefer Node.js built-in modules when possible.
